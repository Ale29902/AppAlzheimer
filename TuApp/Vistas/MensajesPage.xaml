<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:TuApp.VistasModelo"
             x:Class="TuApp.Vistas.MensajesPage"
             Title="Mensajes">

    <ContentPage.BindingContext>
        <vm:MensajeViewModel />
    </ContentPage.BindingContext>

    <ScrollView>
        <StackLayout Padding="10" Spacing="20">

            <!-- Lista de pacientes -->
            <CollectionView x:Name="PacientesCollection"
                ItemsSource="{Binding ListaPacientesRelacionados}"
                SelectedItem="{Binding PacienteSeleccionado}"
                SelectionChanged="PacientesCollection_SelectionChanged"
                SelectionMode="Single"
                ItemsLayout="HorizontalList">

                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame Style="{StaticResource TileButtonStyle}" WidthRequest="150">
                            <Frame.GestureRecognizers>
                                <TapGestureRecognizer Tapped="Paciente_Tapped" CommandParameter="{Binding}" />
                            </Frame.GestureRecognizers>
                            <Label Text="{Binding Nombre}"
                                   LineBreakMode="WordWrap"
                                   HorizontalTextAlignment="Center"
                                   VerticalTextAlignment="Center"
                                   FontSize="16"
                                   TextColor="{DynamicResource BaseTextColor}" />
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- Nombre del paciente -->
            <Label Text="{Binding NombrePacienteConversacion}" 
                   FontSize="18" 
                   FontAttributes="Bold"
                   HorizontalOptions="Center"
                   TextColor="{DynamicResource PrimaryColor}"
                   Margin="0,10,0,0"/>

            <!-- Mensajes -->
            <CollectionView ItemsSource="{Binding ListaMensajes}" HeightRequest="300">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame Padding="10" Margin="5" BackgroundColor="{DynamicResource EntryAndEditorsBackgroundColor}">
                            <Label Text="{Binding Contenido}" TextColor="{DynamicResource BaseTextColor}" />
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- StackLayout del Entry y botÃ³n de enviar -->
            <StackLayout x:Name="MensajePanel"
             Orientation="Horizontal"
             Spacing="10">
                <Entry x:Name="MensajeEntry"
           Placeholder="Escribe un mensaje..."
           Text="{Binding ContenidoNuevoMensaje}"
           HorizontalOptions="FillAndExpand"
           BackgroundColor="{DynamicResource EntryAndEditorsBackgroundColor}" />
                <Button Text="Enviar"
            Command="{Binding EnviarMensajeCommand}"
            Style="{StaticResource PrimaryButtonStyle}" />
            </StackLayout>


        </StackLayout>
    </ScrollView>
</ContentPage>